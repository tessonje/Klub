<!DOCTYPE html> 
<html>
    <head>
        <meta charset="utf-8">
        <title>GiView</title>
        <link href="jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="jquery-1.6.4.min.js" type="text/javascript"></script>
        <script src="jquery.mobile-1.0.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script type="text/javascript">
 			function initialize(id_type)
			{
				if (navigator.geolocation)
				{
					navigator.geolocation.getCurrentPosition(function(position)
					{	
						
						if (typeof(Number.prototype.toRad) === "undefined")
						{
	  						Number.prototype.toRad = function()
							{
	 						   return this * Math.PI / 180;
	 						}
						}
						function Dist(lat1, lon1, lat2, lon2)
						{
							var R = 6371;
							var dLat = (lat2-lat1).toRad();
							var dLon = (lon2-lon1).toRad();
							var lat1 = lat1.toRad();
							var lat2 = lat2.toRad();
							var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
							var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
							var d = R * c;
							return(d.toFixed(3));
						}
						map = new google.maps.Map(document.getElementById("map_canvas"),
						{
							zoom: 15,
							center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
							mapTypeId: google.maps.MapTypeId.ROADMAP
						});
						var location = 
						[
							{
								lat:position.coords.latitude,
								lon:position.coords.longitude,
								title:'Ma position',
								content:'<p>It\'s me mario!!!</p>'
							},
							{
								lat:50.6354802,
								lon:3.0629691,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6354802, 3.0629691),
								type:3,
								title:'Rihour',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/rihour.jpg" height=50 width=30 />'+
								'<h3>Rihour</h3>'+
								'<p>La Place Rihour à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6354802, 3.0629691) + 'km</p>',
								img:  new google.maps.MarkerImage('img/rihour.jpg', null, null, null, new google.maps.Size(21,30))
							},
							{
								lat:50.6360722,
								lon:3.0647608,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6360722, 3.0647608),
								type:4,
								title:'Fnac',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/fnac.png" height=50 width=30 />'+
								'<h3>Fnac</h3>'+
								'<p>La Fnac à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6360722, 3.0647608) + 'km</p>',
								img:  new google.maps.MarkerImage('img/fnac.png', null, null, null, new google.maps.Size(21,30))
							},
							{
								lat:50.6366642,
								lon:3.0631837,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6366642, 3.0631837),
								type:4,
								title:'Furet',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/furet.png" height=50 width=30 />'+
								'<h3>Furet</h3>'+
								'<p>Le Furet à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6366642, 3.0631837) + 'km</p>',
								img:  new google.maps.MarkerImage('img/furet.png', null, null, null, new google.maps.Size(21,30))
							},
							{
								lat:50.6182082,
								lon:3.0498531,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6182082, 3.0498531),
								type:3,
								title:'Wazemmes',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/Wazemmes.jpg" height=50 width=30 />'+
								'<h3>Wazemmes</h3>'+
								'<p>L\'anneau de Mobius de Wazemmes à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6182082, 3.0498531) + 'km</p>',
								img:  new google.maps.MarkerImage('img/Wazemmes.jpg', null, null, null, new google.maps.Size(21,30))
							},
							{
								lat:50.6351740,
								lon:3.0619016,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6351740, 3.0619016),
								type:2,
								title:'Epitech',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/epitech.jpg" height=50 width=30 />'+
								'<h3>Epitech</h3>'+
								'<p>L\'ecole Epitech.</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6351740, 3.0619016) + 'km</p>',
								img:  new google.maps.MarkerImage('img/epitech.jpg', null, null, null, new google.maps.Size(21,30))
							},
							{
								lat:50.6345047,
								lon:3.0567061,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6345047, 3.0567061),
								type:2,
								title:'e-artsup',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/e-artsup.jpg" height=50 width=30 />'+
								'<h3>e-artsup</h3>'+
								'<p>L\'ecole e-artsup.</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6345047, 3.0567061) + 'km</p>',
								img:  new google.maps.MarkerImage('img/e-artsup.jpg', null, null, null, new google.maps.Size(21,30))
							},
							{
								lat:50.6232191,
								lon:3.0665928,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6232191, 3.0665928),
								type:2,
								title:'ISEG',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/ISEG.jpg" height=50 width=30 />'+
								'<h3>ISEG</h3>'+
								'<p>L\'ecole ISEG.</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6232191, 3.0665928) + 'km</p>',
								img:  new google.maps.MarkerImage('img/ISEG.jpg', null, null, null, new google.maps.Size(21,30))
							},
							{
								lat:50.6318736,
								lon:3.0534811,
								distance: Dist(position.coords.latitude,position.coords.longitude, 50.6318736, 3.0534811),
								type:1,
								title:'Atomics',
								content:'<div id="siteNotice">'+
								'</div>'+
								'<img src="img/atomic.jpg" height=50 width=30 />'+
								'<h3>Atomic</h3>'+
								'<p>Bar sur Solferino à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6318736, 3.0534811) + 'km</p>',
								img:  new google.maps.MarkerImage('img/atomic.jpg', null, null, null, new google.maps.Size(21,30))
							}
						];
					
						for (var i = 0; i < location.length; i++)
						{ 
							// init markers
							if (id_type == 0)
							{ 
								var marker = new google.maps.Marker({ position: new google.maps.LatLng(location[i].lat, location[i].lon), map: map, title: location[i].title, icon: location[i].img, flat: true});

								// process multiple info windows
								(function(marker, i) 
								{
									// add click event
									google.maps.event.addListener(marker, 'click', function() 
									{ 
										infowindow = new google.maps.InfoWindow({ content: location[i].content });
										infowindow.open(map, marker);
									});
								})(marker, i);
							}
							if (i == 0 || location[i].type == id_type)
							{ 
								var marker = new google.maps.Marker({ position: new google.maps.LatLng(location[i].lat, location[i].lon), map: map, title: location[i].title, icon: location[i].img, flat: true});

								// process multiple info windows
								(function(marker, i) 
								{
									// add click event
									google.maps.event.addListener(marker, 'click', function() 
									{ 
										infowindow = new google.maps.InfoWindow({ content: location[i].content });
										infowindow.open(map, marker);
									});
								})(marker, i);
							}
						} 
					})();
				}
				else
					alert("Votre navigateur ne prend pas en compte la géolocalisation HTML5");
 			}
		</script>
    </head>
    <body>
   		<div data-role="page" id="page">
			<div data-role="header">
				<h1>GiView</h1>
			</div>
			<div data-role="content">	
				<ul data-role="listview">
					<li><a href="#map" onClick="initialize(0)">map</a></li>
                    <li><a href="#map" onClick="initialize(1)">bars</a></li>
                    <li><a href="#map" onClick="initialize(2)">ecoles</a></li>
                    <li><a href="#map" onClick="initialize(3)">lieux-dit</a></li>
                    <li><a href="#map" onClick="initialize(4)">commerces</a></li>
				</ul>
			</div>
			<div data-role="footer">
				<h4>Giview</h4>
			</div>
		</div>
		<div data-role="page" id="map">
        <script> initialize(0) </script>
			<div data-role="header">
				<h1>map</h1>
			</div>
			<div data-role="content">
				<div id="map_canvas"></div>
			</div>
			<div data-role="footer">
				<a href="#page"><h4>return</h4></a>
			</div>
		</div> 
    </body>
</html>
